# Modelagem de Risco de Crédito (Credit Risk)

![](https://github.com/guilhermeagsouza/banco_de_imagens/blob/master/credit_score.png)
Fonte: telanganatoday.com

###### 1. Objetivo: Construção de um modelo de classificação que possa prever o risco de default (ou inadimplência) com boa acurácia para futuras tomadas de decisão.
###### 2. Modelos: Regressão Logística e Árvores de decisão (decision trees). 
###### 3. Métrica: Curva ROC, utilizada para avaliação e comparação dos resultados obtidos.

*  Pacotes utilizados
```{r}
require(magrittr) #Comando pipe
require(dplyr) #manipulação de dados
require(ggplot2) #visualização dos dados
require(data.table) #manipulação e maior velocidade
require(purrr) #programação funcional
require(gmodels) #modelos estatísticos
require(caret) #biblioteca para machine learning
```

* Leitura dos dados, conhecimento do dataset e transformação de variáveis
```{r}
credit_card <- data.table::fread("creditcard.csv")
credit_card %>% glimpse() #verificando a estrutura das variáveis
credit_card$Class %<>% as.factor() #transformando a variável resposta em fator

```
* Como no dataset original temos quase 300k linhas e 31 variáveis, optamos por amostrar 20k somente parte delas para a compreensão dos dados e da execução do algoritmo. No final da análise será utilizado o dataset completo. 
```{r}
data_credit <- credit_card %>% 
  dplyr::select(-Time) %>% 
  sample_n(20000, replace = F)
```

* 2% é a taxa de inadimplência.
```{r}
gmodels::CrossTable(data_credit$Class)

   Cell Contents
|-------------------------|
|                       N |
|         N / Table Total |
|-------------------------| 
Total Observations in Table:  20000  
|         0 |         1 | 
|-----------|-----------|
|     19968 |        32 | 
|     0.998 |     0.002 | 
|-----------|-----------|

```

* Particionando (Data spliting) os dados de treino em 80% e os dados de teste em 20%.

```{r}
train_index <- createDataPartition(y = data_credit$Class, p = 0.8, list = FALSE, 
                                   times = 1) #times é o número de reamostras
train_credit <- data_credit[train_index, ]
test_credit <- data_credit[-train_index, ]
```

* Para fins de estudo foi utilizada a Análise de Componentes Principais. Essa técnica é conhecida como redução de dimensionalidade.
Os dados foram normalizados para o PCA. Para capturar 80% da variabilidade dos dados, foram necessárias 22 variáveis.
```{r}
PCA <- preProcess(data_credit, method = c("center","scale", "pca"), thresh = 0.8)
Created from 20000 samples and 30 variables

Pre-processing:
  - centered (29)
  - ignored (1)
  - principal component signal extraction (29)
  - scaled (29)

PCA needed 22 components to capture 80 percent of the variance
```

* Treinando um modelo de Regressão Logística para os dados. A acurácia do modelo para os dados de treino foi de 99.87% 
```{r}
train_model <- caret::train(Class ~ ., data = train_credit, method = "glm")
train_model

Generalized Linear Model 

16001 samples
   29 predictor
    2 classes: '0', '1' 

No pre-processing
Resampling: Bootstrapped (25 reps) 
Summary of sample sizes: 16001, 16001, 16001, 16001, 16001, 16001, ... 
Resampling results:

  Accuracy   Kappa    
  0.9987436  0.6169974
```
* Previsão do modelo nos dados de teste e Matriz de confusão.
A Sensibilidade (sensitivity) que avalia os verdadeiros positivos pela soma dos verdadeiros positivos com os falsos negativos foi de 99.85%, enquanto a Especificidade (Specificity) que avalia os verdadeiros negativos pela soma verdadeiros negativos com os falsos positivos foi de 83.33%. 
```{r}
previsao_model <- predict(train_model, test_credit)

confusionMatrix(previsao_model, test_credit$Class)
Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 3987    1
         1    6    5
                                          
               Accuracy : 0.9982          
                 95% CI : (0.9964, 0.9993)
    No Information Rate : 0.9985          
    P-Value [Acc > NIR] : 0.7441          
                                          
                  Kappa : 0.5874          
 Mcnemar's Test P-Value : 0.1306          
                                          
            Sensitivity : 0.9985          
            Specificity : 0.8333          
         Pos Pred Value : 0.9997          
         Neg Pred Value : 0.4545          
             Prevalence : 0.9985          
         Detection Rate : 0.9970          
   Detection Prevalence : 0.9972          
      Balanced Accuracy : 0.9159          
                                          
       'Positive' Class : 0    
```

*** A análise continua..

##### Referências:
* Machine learning can cut credit risk, https://telanganatoday.com/machine-learning-can-cut-credit-risk
* Modelo De Classificação De Risco De Crédito De Empresas, http://www.scielo.br/pdf/rcf/v19n46/v19n46a03.pdf
